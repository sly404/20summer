<!DOCTYPE html>
<!-- 编辑人：施立耀 -->
<html>
	<head>
		<meta charset="utf-8" />
		<title>Highdmin - Responsive Bootstrap 4 Admin Dashboard</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
		<meta content="Coderthemes" name="author" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<!-- App favicon -->
		<link rel="shortcut icon" href="assets/images/favicon.ico">

		<!--Footable-->
		<link href="../plugins/footable/css/footable.core.css" rel="stylesheet">

		<!-- App css -->
		<link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
		<link href="assets/css/style.css" rel="stylesheet" type="text/css" />
		
		<!-- Sweet Alert css -->
		<link href="../plugins/sweet-alert/sweetalert2.min.css" rel="stylesheet" type="text/css" />
		
		<!-- Toastr css -->
		<link href="../plugins/jquery-toastr/jquery.toast.min.css" rel="stylesheet" />

		<script src="assets/js/modernizr.min.js"></script>

		<style>
			table td {
			            max-width: 100px;
			            word-wrap: break-word;
			            text-overflow: ellipsis;
			            white-space: nowrap;
			            overflow: hidden;
						table-layout: fixed
			        }
			/* table td:hover {
			            white-space: normal;
			            overflow: auto;
			        } */
		</style>

	</head>

	<body>

		<!-- Navigation Bar-->
		<header id="topnav">
			<div class="topbar-main">
				<div class="container-fluid">

					<!-- Logo container-->
					<div class="logo">
						<!-- Text Logo -->
						<!-- <a href="index.html" class="logo">
                            <span class="logo-small"><i class="mdi mdi-radar"></i></span>
                            <span class="logo-large"><i class="mdi mdi-radar"></i> Highdmin</span>
                        </a> -->
						<!-- Image Logo -->
						<a href="index.html" class="logo">
							<img src="assets/images/logo_sm.png" alt="" height="26" class="logo-small">
							<img src="assets/images/logo.png" alt="" height="40" class="logo-large">
						</a>

					</div>
					<!-- End Logo container-->


					<div class="menu-extras topbar-custom">

						<ul class="list-unstyled topbar-right-menu float-right mb-0">

							<li class="menu-item">
								<!-- Mobile menu toggle-->
								<a class="navbar-toggle nav-link">
									<div class="lines">
										<span></span>
										<span></span>
										<span></span>
									</div>
								</a>
								<!-- End mobile menu toggle-->
							</li>
							<li class="dropdown notification-list hide-phone">
								<a class="nav-link dropdown-toggle waves-effect nav-user" data-toggle="dropdown" href="#" role="button"
								 aria-haspopup="false" aria-expanded="false">
									<i class="mdi mdi-earth"></i> English <i class="mdi mdi-chevron-down"></i>
								</a>
								<div class="dropdown-menu dropdown-menu-right">

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item">
										Spanish
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item">
										Italian
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item">
										French
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item">
										Russian
									</a>

								</div>
							</li>

							<li class="dropdown notification-list">
								<a class="nav-link dropdown-toggle arrow-none waves-effect" data-toggle="dropdown" href="#" role="button"
								 aria-haspopup="false" aria-expanded="false">
									<i class="fi-bell noti-icon"></i>
									<span class="badge badge-danger badge-pill noti-icon-badge">4</span>
								</a>
								<div class="dropdown-menu dropdown-menu-right dropdown-lg">

									<!-- item-->
									<div class="dropdown-item noti-title">
										<h6 class="m-0"><span class="float-right"><a href="" class="text-dark"><small>Clear All</small></a> </span>Notification</h6>
									</div>

									<div class="slimscroll" style="max-height: 230px;">
										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-success"><i class="mdi mdi-comment-account-outline"></i></div>
											<p class="notify-details">Caleb Flakelar commented on Admin<small class="text-muted">1 min ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-info"><i class="mdi mdi-account-plus"></i></div>
											<p class="notify-details">New user registered.<small class="text-muted">5 hours ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-danger"><i class="mdi mdi-heart"></i></div>
											<p class="notify-details">Carlos Crouch liked <b>Admin</b><small class="text-muted">3 days ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-warning"><i class="mdi mdi-comment-account-outline"></i></div>
											<p class="notify-details">Caleb Flakelar commented on Admin<small class="text-muted">4 days ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-purple"><i class="mdi mdi-account-plus"></i></div>
											<p class="notify-details">New user registered.<small class="text-muted">7 days ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-custom"><i class="mdi mdi-heart"></i></div>
											<p class="notify-details">Carlos Crouch liked <b>Admin</b><small class="text-muted">13 days ago</small></p>
										</a>
									</div>

									<!-- All-->
									<a href="javascript:void(0);" class="dropdown-item text-center text-primary notify-item notify-all">
										View all <i class="fi-arrow-right"></i>
									</a>

								</div>
							</li>

							<li class="dropdown notification-list">
								<a class="nav-link dropdown-toggle arrow-none waves-effect" data-toggle="dropdown" href="#" role="button"
								 aria-haspopup="false" aria-expanded="false">
									<i class="fi-speech-bubble noti-icon"></i>
									<span class="badge badge-dark badge-pill noti-icon-badge">6</span>
								</a>
								<div class="dropdown-menu dropdown-menu-right dropdown-lg">

									<!-- item-->
									<div class="dropdown-item noti-title">
										<h6 class="m-0"><span class="float-right"><a href="" class="text-dark"><small>Clear All</small></a> </span>Chat</h6>
									</div>

									<div class="slimscroll" style="max-height: 230px;">
										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-2.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Cristina Pride</p>
											<p class="text-muted font-13 mb-0 user-msg">Hi, How are you? What about our next meeting</p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-3.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Sam Garret</p>
											<p class="text-muted font-13 mb-0 user-msg">Yeah everything is fine</p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-4.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Karen Robinson</p>
											<p class="text-muted font-13 mb-0 user-msg">Wow that's great</p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-5.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Sherry Marshall</p>
											<p class="text-muted font-13 mb-0 user-msg">Hi, How are you? What about our next meeting</p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-6.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Shawn Millard</p>
											<p class="text-muted font-13 mb-0 user-msg">Yeah everything is fine</p>
										</a>
									</div>

									<!-- All-->
									<a href="javascript:void(0);" class="dropdown-item text-center text-primary notify-item notify-all">
										View all <i class="fi-arrow-right"></i>
									</a>

								</div>
							</li>

							<li class="dropdown notification-list">
								<a class="nav-link dropdown-toggle waves-effect nav-user" data-toggle="dropdown" href="#" role="button"
								 aria-haspopup="false" aria-expanded="false">
									<img src="assets/images/users/avatar-1.jpg" alt="user" class="rounded-circle"> <span class="ml-1 pro-user-name">Maxine
										K <i class="mdi mdi-chevron-down"></i> </span>
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<!-- item-->
									<div class="dropdown-item noti-title">
										<h6 class="text-overflow m-0">Welcome !</h6>
									</div>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-head"></i> <span>My Account</span>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-cog"></i> <span>Settings</span>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-help"></i> <span>Support</span>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-lock"></i> <span>Lock Screen</span>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-power"></i> <span>Logout</span>
									</a>

								</div>
							</li>
						</ul>
					</div>
					<!-- end menu-extras -->

					<div class="clearfix"></div>

				</div> <!-- end container -->
			</div>
			<!-- end topbar-main -->

		</header>
		<!-- End Navigation Bar-->


		<div class="wrapper">
			<div class="container-fluid">

				<!-- Page-Title -->
				<div class="row">
					<div class="col-sm-12">
						<div class="page-title-box">
							<div class="btn-group pull-right">
								<ol class="breadcrumb hide-phone p-0 m-0">
									<li class="breadcrumb-item"><a href="ordermanage.html">订单管理</a></li>
									<li class="breadcrumb-item"><a href="#">订单菜品管理</a></li>
								</ol>
							</div>
							<h4 class="page-title"><i class="mdi mdi-food" style="display: inline;"></i>订单菜品管理</h4>
						</div>
					</div>
				</div>
				<!-- end page title end breadcrumb -->

				<!-- 展示菜品详细信息 -->
				<div class="row">
					<div class="col-12">
						<div class="card-box">
							<!-- <h4 class="m-t-0 header-title">订单菜品管理</h4> -->
							<!-- <p class="text-muted m-b-30 font-13">
								include filtering in your FooTable.
							</p> -->

							<div class="mb-3">
								<div class="row">
									<div class="col-12 text-sm-center form-inline">
										<div class="form-group mr-2">
											<select id="demo-foo-filter-status" class="custom-select">
												<option value="">展示所有</option>
												<option value="待烹饪">待烹饪</option>
												<option value="已烹饪">已烹饪</option>
												<option value="已取消">已取消</option>
												<!-- <option value="suspended">Suspended</option> -->
											</select>
										</div>
										<div class="form-group">
											<input id="demo-foo-search" type="text" placeholder="Search" class="form-control" autocomplete="on">
										</div>
									</div>
								</div>
							</div>
							<table id="demo-foo-filtering" class="table table-striped table-bordered toggle-circle m-b-0" data-page-size="7">
								<thead>
									<tr>
										<th data-toggle="true">菜品名</th>
										<th>菜品编号</th>
										<th data-hide="phone">菜品数量</th>
										<th data-hide="phone, tablet" data-sort-ignore="true">备注</th>
										<th data-hide="phone, tablet">菜品状态</th>
										<th align="center" data-sort-ignore="true"><b>操作</b></th>
									</tr>
								</thead>
								<tbody>
								</tbody>
								<tfoot>
									<tr class="active">
										<td colspan="6">
											<div class="text-right">
												<ul class="pagination pagination-split justify-content-end footable-pagination m-t-10 m-b-0"></ul>
											</div>
										</td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
				<!-- 菜品详细信息展示结束 -->

			</div> <!-- end container -->
		</div>
		<!-- end wrapper -->


		<!-- jQuery  -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/popper.min.js"></script>
		<script src="assets/js/bootstrap.min.js"></script>
		<script src="assets/js/waves.js"></script>
		<script src="assets/js/jquery.slimscroll.js"></script>

		<!--FooTable-->
		<script src="../plugins/footable/js/footable.all.min.js"></script>
		<!--FooTable Example-->
		<script src="assets/pages/jquery.footable.js"></script>
		
		<!-- Sweet Alert Js  -->
		<script src="../plugins/sweet-alert/sweetalert2.min.js"></script>
		<script src="assets/pages/jquery.sweet-alert.init.js"></script>
		
		<!-- Toastr js -->
		<script src="../plugins/jquery-toastr/jquery.toast.min.js" type="text/javascript"></script>

		<!-- App js -->
		<script src="assets/js/jquery.core.js"></script>
		<script src="assets/js/jquery.app.js"></script>

		<!-- 自定义脚本 -->
		<script>
			$(document).ready(function(){
				console.log("onload");
				order_id = sessionStorage.getItem("order_id");
				console.log(order_id);
				$.get("http://39.98.127.39:8080/order/show_dish_ordered",
				{"order_id":order_id},
				function(data,status){
					if(status == "success")
					{
						if(data == "login")
						{
							location.href = "page-login.html";
						}
						else{
							mydishlist = data;
							// sessionStorage.setItem(order_id.toString(),JSON.stringify(data));//cache the order fish data;
							dishtableinit(data);
						}
					}
				},"json")
				// var footable = $('#demo-foo-filtering').data('footable');
			})
			
			function matchdish(id)//it is suitbale to get from a few data,not big data,if data is big,get from html directly
			{
				for(let i = 0;i<mydishlist.length;i++)
				{
					if(mydishlist[i].dish_id == id)
					{
						return mydishlist[i];
					}
				}
				return null;
			}
			
			function dishtableinit(jsondata) {
				for (var i = 0; i < jsondata.length; i++) {
					var dynamicnode = '<tr>' +
						'										<td>' + jsondata[i].dish_name + '</td>' +
						'										<td class="dish_id">' + jsondata[i].dish_id + '</td>' +
						'										<td>' + jsondata[i].dish_num + '</td>' +
						'										<td onmousemove="floatshow(this)">' + jsondata[i].note + '</td>' +
						'										<td class="dish_state">'+dishstate(jsondata[i].dish_state) +'</td>'+
						'										<td align="center">' +
						'											<a class="btn btn-sm btn-success" onclick="dishcook(this)">完成</a>' +
						'											<a class="btn btn-sm btn-danger" onclick="dishcancel(this)">取消</a>' +
						'										</td>' +
						'									</tr>';
					$("#demo-foo-filtering").append(dynamicnode);
				}
			}

			// let dishjsonstr =
			// 	'[{"dish_name":"小鸡炖蘑菇","dish_id":12345678981,"dish_num":3,"note":"不要辣，一点都不要,测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字","dish_state":1},{"dish_name":"干锅牛蛙","dish_id":12345678982,"dish_num":1,"note":"微微辣就行","dish_state":0},{"dish_name":"小炒牛肉","dish_id":12345678985,"dish_num":1,"note":"要辣，重庆人都怕的那种","dish_state":-1}]';
			// let dishjson = JSON.parse(dishjsonstr);

			function dishstate(state) {
				if (state == -1) {
					return '<span class="badge label-table badge-secondary">已取消</span>';
				} else if (state == 0) {
					return '<span class="badge label-table badge-success">已烹饪</span>';
				} else if (state > 0) {
					return '<span class="badge label-table badge-danger">待烹饪:' + state + '</span>';
				}
			}

			function dishcancel(e) {
				let dishrow = e.parentNode.parentNode;
				let dish_id = dishrow.getElementsByClassName("dish_id")[0].innerText;
				let dishdata = matchdish(dish_id);
				if(dishdata.dish_state == -1)
				{
					$.toast({
					    heading: '菜品已取消!',
					    text: '菜品目前已取消，无需重复取消',
					    position: 'top-right',
					    loaderBg: '#3085d6',
					    icon: 'info',
					    hideAfter: 3000,
					    stack: 1
					});
				}
				else{
					dishdata.dish_state = -1;
					swal({ 
					  title: '确定取消菜品？', 
					  text: '你将无法恢复它！', 
					  type: 'warning',
					  showCancelButton: true, 
					  confirmButtonColor: '#3085d6',
					  cancelButtonColor: '#d33',
					  confirmButtonText: '确定取消！', 
					}).then(function(){
					$.post("http://39.98.127.39:8080/order/update_dish_ordered",
					// {"order_id":order_id,"dish_id":dish_id,"dish_num":3,"dish_state":-1,"note":"的萨克等哈斯柯达你是哪的"},
					dishdata,
					function(data,status){ 
						if(status == "success")
						{
							if(data == true)
							{
								dishrow.getElementsByClassName("dish_state")[0].innerHTML = dishstate(-1);
								swal(
								  '订单取消！',
								  '你的订单已取消',
								  'success'
								  );
							}
						}
					})//post end
					})//swal end
				}//else end
			}

			function dishcook(e) {
				let dishrow = e.parentNode.parentNode;
				let dish_id = dishrow.getElementsByClassName("dish_id")[0].innerText;
				let dishdata = matchdish(dish_id);
				if(dishdata.dish_state > 0)
				{
					dishdata.dish_state -= 1;
					swal({
					  title: '烹饪完成？', 
					  text: '状态确认', 
					  type: 'warning',
					  showCancelButton: true, 
					  confirmButtonColor: '#3085d6',
					  cancelButtonColor: '#d33',
					  confirmButtonText: '确定完成！', 
					}).then(function(){
					$.post("http://39.98.127.39:8080/order/update_dish_ordered",
					// {"order_id":order_id,"dish_id":dish_id,"dish_num":3,"dish_state":-1,"note":"的萨克等哈斯柯达你是哪的"},
					dishdata,
					function(data,status){ 
						if(status == "success")
						{
							if(data == true)
							{
								dishrow.getElementsByClassName("dish_state")[0].innerHTML = dishstate(dishdata.dish_state);
								swal(
								  // '',
								  '烹饪状态已修改',
								  'success'
								  );
							}
						}
					})//post end
					})//promise end
				}//if end
				else if(dishdata.dish_state == 0)
				{
					$.toast({
					    heading: '菜品已烹饪完成!',
					    text: '菜品目前已烹饪完成，无需重复确认',
					    position: 'top-right',
					    loaderBg: '#3b98b5',
					    icon: 'info',
					    hideAfter: 3000,
					    stack: 1
					});
				}
				else{
					$.toast({
					    heading: '菜品已取消!',
					    text: '菜品目前已取消，确认完成无效',
					    position: 'top-right',
					    loaderBg: '#3b98b5',
					    icon: 'info',
					    hideAfter: 3000,
					    stack: 1
					});
				}
			}
			
			function floatshow(target)
			{ 
				  // $(target).attr("title",target.innerText);
				  target.setAttribute("title",target.innerText);
			}

			// dishtableinit(dishjson);
		</script>

		<!-- test -->
		<script>
			// console.log(dishjson);
			// console.log(dishtest);
			// console.log(localStorage.getItem("order_id"));//后期根据这个id获取菜品列表
		</script>

	</body>
</html>
