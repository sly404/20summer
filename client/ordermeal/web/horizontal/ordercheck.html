<!DOCTYPE html>
<!-- 编辑人：施立耀 -->
<html>
	<head>
		<meta charset="utf-8" />
		<title>老街烧烤，记录你生活的烟火气</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
		<meta content="Coderthemes" name="author" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<!-- App favicon -->
		<link rel="shortcut icon" href="assets/images/favicon.ico">

		<!-- App css -->
		<link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
		<link href="assets/css/style.css" rel="stylesheet" type="text/css" />

		<script src="assets/js/modernizr.min.js"></script>

	</head>

	<body>

		<!-- Navigation Bar-->
		<header id="topnav">
			<div class="topbar-main">
				<div class="container-fluid">

					<!-- Logo container-->
					<div class="logo">
						<!-- Text Logo -->
						<!-- <a href="index.html" class="logo">
                            <span class="logo-small"><i class="mdi mdi-radar"></i></span>
                            <span class="logo-large"><i class="mdi mdi-radar"></i> Highdmin</span>
                        </a> -->
						<!-- Image Logo -->
						<a href="index.html" class="logo">
							<img src="assets/images/logo_sm.png" alt="" height="26" class="logo-small">
							<img src="assets/images/logo.png" alt="" height="40" class="logo-large">
						</a>

					</div>
					<!-- End Logo container-->


					<div class="menu-extras topbar-custom">

						<ul class="list-unstyled topbar-right-menu float-right mb-0">

							<li class="menu-item">
								<!-- Mobile menu toggle-->
								<a class="navbar-toggle nav-link">
									<div class="lines">
										<span></span>
										<span></span>
										<span></span>
									</div>
								</a>
								<!-- End mobile menu toggle-->
							</li>
							<li class="dropdown notification-list hide-phone">
								<a class="nav-link dropdown-toggle waves-effect nav-user" data-toggle="dropdown" href="#" role="button"
								 aria-haspopup="false" aria-expanded="false">
									<i class="mdi mdi-earth"></i> English <i class="mdi mdi-chevron-down"></i>
								</a>
								<div class="dropdown-menu dropdown-menu-right">

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item">
										Spanish
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item">
										Italian
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item">
										French
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item">
										Russian
									</a>

								</div>
							</li>

							<li class="dropdown notification-list">
								<a class="nav-link dropdown-toggle arrow-none waves-effect" data-toggle="dropdown" href="#" role="button"
								 aria-haspopup="false" aria-expanded="false">
									<i class="fi-bell noti-icon"></i>
									<span class="badge badge-danger badge-pill noti-icon-badge">4</span>
								</a>
								<div class="dropdown-menu dropdown-menu-right dropdown-lg">

									<!-- item-->
									<div class="dropdown-item noti-title">
										<h6 class="m-0"><span class="float-right"><a href="" class="text-dark"><small>Clear All</small></a> </span>Notification</h6>
									</div>

									<div class="slimscroll" style="max-height: 230px;">
										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-success"><i class="mdi mdi-comment-account-outline"></i></div>
											<p class="notify-details">Caleb Flakelar commented on Admin<small class="text-muted">1 min ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-info"><i class="mdi mdi-account-plus"></i></div>
											<p class="notify-details">New user registered.<small class="text-muted">5 hours ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-danger"><i class="mdi mdi-heart"></i></div>
											<p class="notify-details">Carlos Crouch liked <b>Admin</b><small class="text-muted">3 days ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-warning"><i class="mdi mdi-comment-account-outline"></i></div>
											<p class="notify-details">Caleb Flakelar commented on Admin<small class="text-muted">4 days ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-purple"><i class="mdi mdi-account-plus"></i></div>
											<p class="notify-details">New user registered.<small class="text-muted">7 days ago</small></p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon bg-custom"><i class="mdi mdi-heart"></i></div>
											<p class="notify-details">Carlos Crouch liked <b>Admin</b><small class="text-muted">13 days ago</small></p>
										</a>
									</div>

									<!-- All-->
									<a href="javascript:void(0);" class="dropdown-item text-center text-primary notify-item notify-all">
										View all <i class="fi-arrow-right"></i>
									</a>

								</div>
							</li>

							<li class="dropdown notification-list">
								<a class="nav-link dropdown-toggle arrow-none waves-effect" data-toggle="dropdown" href="#" role="button"
								 aria-haspopup="false" aria-expanded="false">
									<i class="fi-speech-bubble noti-icon"></i>
									<span class="badge badge-dark badge-pill noti-icon-badge">6</span>
								</a>
								<div class="dropdown-menu dropdown-menu-right dropdown-lg">

									<!-- item-->
									<div class="dropdown-item noti-title">
										<h6 class="m-0"><span class="float-right"><a href="" class="text-dark"><small>Clear All</small></a> </span>Chat</h6>
									</div>

									<div class="slimscroll" style="max-height: 230px;">
										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-2.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Cristina Pride</p>
											<p class="text-muted font-13 mb-0 user-msg">Hi, How are you? What about our next meeting</p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-3.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Sam Garret</p>
											<p class="text-muted font-13 mb-0 user-msg">Yeah everything is fine</p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-4.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Karen Robinson</p>
											<p class="text-muted font-13 mb-0 user-msg">Wow that's great</p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-5.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Sherry Marshall</p>
											<p class="text-muted font-13 mb-0 user-msg">Hi, How are you? What about our next meeting</p>
										</a>

										<!-- item-->
										<a href="javascript:void(0);" class="dropdown-item notify-item">
											<div class="notify-icon"><img src="assets/images/users/avatar-6.jpg" class="img-fluid rounded-circle" alt="" />
											</div>
											<p class="notify-details">Shawn Millard</p>
											<p class="text-muted font-13 mb-0 user-msg">Yeah everything is fine</p>
										</a>
									</div>

									<!-- All-->
									<a href="javascript:void(0);" class="dropdown-item text-center text-primary notify-item notify-all">
										View all <i class="fi-arrow-right"></i>
									</a>

								</div>
							</li>

							<li class="dropdown notification-list">
								<a class="nav-link dropdown-toggle waves-effect nav-user" data-toggle="dropdown" href="#" role="button"
								 aria-haspopup="false" aria-expanded="false">
									<img src="assets/images/users/avatar-1.jpg" alt="user" class="rounded-circle"> <span class="ml-1 pro-user-name">Maxine
										K <i class="mdi mdi-chevron-down"></i> </span>
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<!-- item-->
									<div class="dropdown-item noti-title">
										<h6 class="text-overflow m-0">Welcome !</h6>
									</div>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-head"></i> <span>My Account</span>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-cog"></i> <span>Settings</span>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-help"></i> <span>Support</span>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-lock"></i> <span>Lock Screen</span>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="fi-power"></i> <span>Logout</span>
									</a>

								</div>
							</li>
						</ul>
					</div>
					<!-- end menu-extras -->

					<div class="clearfix"></div>

				</div> <!-- end container -->
			</div>
			<!-- end topbar-main -->

		</header>
		<!-- End Navigation Bar-->


		<div class="wrapper">
			<div class="container-fluid">

				<!-- Page-Title -->
				<div class="row">
					<div class="col-sm-12">
						<div class="page-title-box">
							<div class="btn-group pull-right">
								<ol class="breadcrumb hide-phone p-0 m-0">
									<li class="breadcrumb-item"><a href="ordermanage.html">订单管理</a></li>
									<li class="breadcrumb-item"><a>订单结算</a></li>
								</ol>
							</div>
							<h4 class="page-title">Invoice</h4>
						</div>
					</div>
				</div>
				<!-- end page title end breadcrumb -->

				<div class="row">
					<div class="col-md-12">
						<div class="card-box">
							<div class="clearfix">
								<div class="pull-left mb-3">
									<img src="assets/images/logo.png" alt="" height="28">
								</div>
								<div class="pull-right">
									<h4 class="m-0 d-print-none">Invoice</h4>
								</div>
							</div>


							<!-- <div class="row">
								<div class="col-6">
									<div class="pull-left mt-3">
										<p><b>Hello, Stanley Jones</b></p>
										<p class="text-muted">Thanks a lot because you keep purchasing our products. Our company
											promises to provide high quality products for you as well as outstanding
											customer service for every transaction. </p>
									</div>
								</div> -->
							<!-- end col -->

							<!-- <div class="col-4 offset-2">
									<div class="mt-3 pull-right">
										<p class="m-b-10"><strong>Order Date: </strong> Jan 17, 2016</p>
										<p class="m-b-10"><strong>Order Status: </strong> <span class="badge badge-success">Paid</span></p>
										<p class="m-b-10"><strong>Order ID: </strong> #123456</p>
									</div>
								</div> -->
							<!-- end col -->
							<!-- </div> -->
							<!-- end row -->

							<div class="row">
								<div class="col-6">

									<div class="mt-3">
										<p class="m-b-10"><strong>结算时间: </strong> <span id="settlement_time" style="font-weight: bold;"></span></p>
										<p class="m-b-10"><strong>桌号: </strong><span id="table_id" style="font-weight: bold;"></span></p>
										<p class="m-b-10"><strong>订单编号: </strong> <span id="order_id" style="font-weight: bold;"></span></p>
									</div>
								</div><!-- end col -->

								<div class="col-6">

									<div class="mt-3" style="float: right;">
										<p class="m-b-10"><strong>下单时间: </strong> <span id="build_time" style="font-weight: bold;"></p>
										<p class="m-b-10"><strong>用户名字: </strong><span id="user_name" style="font-weight: bold;"></span></p>
										<p class="m-b-10"><strong>用户编号: </strong> <span id="user_id" style="font-weight: bold;"></span></p>
									</div>
								</div><!-- end col -->
							</div>
							<!-- end row -->

							<!-- <div class="row mt-3">
								<div class="col-6">
									<h6>Billing Address</h6>

									<address class="line-h-24">
										Stanley Jones<br>
										795 Folsom Ave, Suite 600<br>
										San Francisco, CA 94107<br>
										<abbr title="Phone">P:</abbr> (123) 456-7890
									</address>

								</div>

								<div class="col-6">
									<h6>Shipping Address</h6>

									<address class="line-h-24">
										Stanley Jones<br>
										795 Folsom Ave, Suite 600<br>
										San Francisco, CA 94107<br>
										<abbr title="Phone">P:</abbr> (123) 456-7890
									</address>

								</div>
							</div> -->

							<div class="row">
								<div class="col-md-12">
									<div class="table-responsive">
										<table class="table mt-4" id="invoice_table">
											<thead>
												<tr>
													<th>菜品编号</th>
													<th>菜品名字</th>
													<th>菜品数量</th>
													<th>单价</th>
													<th class="text-right">合计</th>
												</tr>
											</thead>
											<tbody id="invoice_body">
											</tbody>
										</table>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-6">
									<div class="clearfix pt-5">
										<h6 class="text-muted">备注:</h6>
										<small>
											欢迎您的光临，本店菜品质量有保障，如遇任何问题，可凭借此小票到前台咨询，
											我们将为您妥善解决，祝您用餐愉快
										</small>
									</div>

								</div>
								<div class="col-6">
									<div class="float-right">
										<p><b>总价:</b><span id="totalprice" style="font-weight: bold;"></span></p>
										<p><b>折扣:</b><span id="discount" style="font-weight: bold;"></span></p>
										<b>应付：</b>
										<h3 style="display: inline;"><span id="pay" style="font-weight: bold;"></span></h3>
									</div>
									<div class="clearfix"></div>
								</div>
							</div>

							<div class="hidden-print mt-4 mb-4">
								<div class="text-right">
									<a href="javascript:window.print()" class="btn btn-primary waves-effect waves-light"><i class="fa fa-print m-r-5"></i>
										打印</a>
									<a href="#" class="btn waves-effect waves-light" style="background-color: #69e169;color:white;">结算</a>
								</div>
							</div>
						</div>

					</div>

				</div>
				<!-- end row -->


			</div> <!-- end container -->
		</div>
		<!-- end wrapper -->

		<!-- jQuery  -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/popper.min.js"></script>
		<script src="assets/js/bootstrap.min.js"></script>
		<script src="assets/js/waves.js"></script>
		<script src="assets/js/jquery.slimscroll.js"></script>

		<!-- App js -->
		<script src="assets/js/jquery.core.js"></script>
		<script src="assets/js/jquery.app.js"></script>
		<!-- 自定义函数 -->
		<script>
			//定义日期格式 eg.2020-08-14 20:34:32
			Date.prototype.Format = function(fmt) {
				var o = {
					"M+": this.getMonth() + 1, //月份
					"d+": this.getDate(), //日
					"H+": this.getHours(), //小时
					"m+": this.getMinutes(), //分
					"s+": this.getSeconds(), //秒
					"q+": Math.floor((this.getMonth() + 3) / 3), //季度
					"S": this.getMilliseconds() //毫秒
				};
				if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
				for (var k in o)
					if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" +
						o[k]).substr(("" + o[k]).length)));
				return fmt;
			}
			
			function initpage(orderjson,dishes)
			{
				$("#settlement_time").text(orderjson.settlement_time);
				$("#table_id").text(orderjson.table_id);
				$("#order_id").text(orderjson.order_id);
				$("#build_time").text(orderjson.build_time);
				$("#user_name").text(orderjson.user_name);
				$("#user_id").text(orderjson.user_id);
				let totalprice = 0;
				for(let i = 0,len = dishes.length;i<len&&dishes[i].dish_state == 0;i++)//find the cooked dish
				{
					var tablerow = "<tr>" +
						"		<td>"+dishes[i].dish_id+"</td>" +
						"		<td>" +
						"			<b>"+dishes[i].dish_name+"</b> <br />" +
						"		</td>" +
						"		<td>"+dishes[i].dish_num+"</td>" +
						"		<td>"+dishes[i].dish_price+"</td>" +
						"		<td class=\"text-right total\" style=\"font-weight: bold;\">"+(dishes[i].dish_num)*(dishes[i].dish_price)+"</td>" +
						"	</tr>";
						$("#invoice_body").innerHTML = "";
						$("#invoice_table").append(tablerow);
						totalprice += dishes[i].dish_num*dishes[i].dish_price;
				}
				$("#totalprice").text(totalprice);
				$("#discount").text(orderjson.order_discount);
				$("#pay").text(totalprice-orderjson.order_discount);
			}

			window.onload = function() {
				var orderstr = sessionStorage.getItem("order");
				var orderjson = JSON.parse(orderstr);
				console.log(orderjson);
				//ajax send data:order_id,get the order_dish array jsonstr that has not been canceled 
				let dishjsonstr =
					'[{"dish_name":"小鸡炖蘑菇","dish_id":12345678981,"dish_num":3,"dish_price":45,"note":"不要辣，一点都不要,测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字测试过长文字","dish_state":0},{"dish_name":"干锅牛蛙","dish_id":12345678982,"dish_num":1,"dish_price":50,"note":"微微辣就行","dish_state":0},{"dish_name":"小炒牛肉","dish_id":12345678985,"dish_num":1,"dish_price":60,"note":"要辣，重庆人都怕的那种","dish_state":-1}]';
				let dishes = JSON.parse(dishjsonstr);
				// let dishes;
				order_id = sessionStorage.getItem("order_id");
				console.log(order_id);
				$.get("http://localhost:8080/order/show_dish_ordered",
				{"order_id":order_id},
				function(data,status){
					if(status == "success")
					{
						if(data == "login")
						{
							location.href = "page-login.html";
						}
						else{
							console.log(data);
							initpage(orderjson,data);
						}
					}
				},"json")
				// let datetime = new Date().Format("yyyy-MM-dd HH:mm:ss");
			}
		</script>

	</body>
</html>
